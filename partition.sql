
[QUERY PARTITION 절];
--C1열은 JOB을 3개의 파티션으로 지정했다. SAL이 3개의 파티션(CLERK,MANAGER,SALESMAN)으로 집계되어 950,2580,5600으로 반환
--C2열은 파티션을 지정하지 않았다. 전체 행에 하나의 파티션으로 동작하므로 9400이 반환된다.

SELECT EMPNO,
	   JOB,
	   SAL,
	   SUM(SAL) OVER (PARTITION BY JOB) AS C1,
	   SUM(SAL) OVER () AS C2
FROM SCOTT.EMP
WHERE DEPTNO =30
ORDER BY 2,1;

[ORDER BY 절];
SELECT EMPNO,SAL,SUM(sAL) OVER(ORDER BY SAL,EMPNO) AS C1
FROM SCOTT.EMP 
WHERE DEPTNO = 30
ORDER BY 2,1;
	  

SELECT JOB,
	   TO_CHAR(HIREDATE,'YYYY-MM-DD') AS HIREDATE,
	   SAL,
	   SUM(sal) OVER (PARTITION BY job ORDER BY hiredate) AS c1
FROM scott.EMP e 
WHERE deptno =30
ORDER BY 1,2;

JOB			HIREATE		SAL		C1
CLERK		1981-12-03	950		950
MANAGER		1981-05-01	2850	2850
SALESMAN	1981-02-20	1600	1600
SALESMAN	1981-02-22	1250	2850 --1600+1250
SALESMAN	1981-09-08	1500	4350 --1600+1250+1500
SALESMAN	1981-09-28	1250	5600 --1600+1250+1500+1250 
;

SELECT JOB,
	   TO_CHAR(HIREDATE,'YYYY-MM-DD') AS HIREDATE,
	   SAL,
	   SUM(sal) OVER (PARTITION BY job) AS c1
FROM scott.EMP e 
WHERE deptno =30
ORDER BY 1,2;

JOB			HIREATE		SAL		C1
CLERK		1981-12-03	950		950
MANAGER		1981-05-01	2850	2850
SALESMAN	1981-02-20	1600	5600 --1600+1250+1500+1250
SALESMAN	1981-02-22	1250	5600 --1600+1250+1500+1250
SALESMAN	1981-09-08	1500	5600 --1600+1250+1500+1250
SALESMAN	1981-09-28	1250	5600 --1600+1250+1500+1250
;


[KEEP 키워드];
-- JOB 파티션 별 SAL가 최소인 행을 대상으로 COMM의 최고값을 조회한다.
-- salesman파티션의 경우 sal이 1250인 ward와 martin이 집계대상이다. 해당 행에서 comm의 최고값인 1400이 반환된다.

SELECT ENAME,JOB,SAL,COMM
	  ,MAX(COMM) KEEP (DENSE_RANK FIRST ORDER BY SAL) OVER (PARTITION BY JOB) AS C1
FROM SCOTT.EMP 
WHERE DEPTNO = 30
ORDER BY 2,3,4;

ENAME	JOB			SAL		COMM	C1
JAMES	CLERK		950		NULL	null
BLAKE	MANAGER		850		NULL	null
WARD	SALESMAN	1250	500		1400
MARTIN	SALESMAN	1250	1400	1400
TURNER	SALESMAN	1500	0		1400
ALLEN	SALESMAN	1600	300		1400

;

--슈도칼럼
SELECT deptno,rowid AS c1 FROM scott.dept;

SELECT empno,job,sal
	   ,sum(sal)over(PARTITION BY job) AS c1
       ,sum(sal)over()AS c2
FROM scott.emp
WHERE deptno = 30
ORDER BY 2,1; --2번쨰,1번째 컬럼 순으로 오름차순 정렬


SELECT empno,sal,sum(sal) over(ORDER BY sal,empno) AS c1
FROM scott.EMP
WHERE deptno = 30
ORDER BY 2,1; --ORDER BY 절로 파티션 내의 정렬순서 지정

